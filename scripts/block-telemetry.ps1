#   Description:
# This script blocks telemetry related domains via the hosts file and related
# IPs via Windows Firewall.
#
# Please note that adding these domains may break certain software like iTunes
# or Skype. As this issue is location dependent for some domains, they are not
# commented by default. The domains known to cause issues marked accordingly.
# Please see the related issue:
# <https://github.com/W4RH4WK/Debloat-Windows-10/issues/79>

Import-Module -DisableNameChecking $PSScriptRoot\..\lib\force-mkdir.psm1

Write-Output "Disabling telemetry via Group Policies"
force-mkdir "HKLM:\SOFTWARE\Policies\Microsoft\Windows\DataCollection"
Set-ItemProperty "HKLM:\SOFTWARE\Policies\Microsoft\Windows\DataCollection" "AllowTelemetry" 0

# Entries related to Akamai have been reported to cause issues with Widevine
# DRM.

Write-Output "Adding telemetry domains to hosts file"
$hosts_file = "$env:systemroot\System32\drivers\etc\hosts"
$domains = @(
    "184-86-53-99.deploy.static.akamaitechnologies.com"
    "ceuswatcab01.blob.core.windows.net"
    "ceuswatcab02.blob.core.windows.net"
    "eaus2watcab01.blob.core.windows.net"
    "eaus2watcab02.blob.core.windows.net"
    "weus2watcab01.blob.core.windows.net"
    "weus2watcab02.blob.core.windows.net"
    "v10c.events.data.microsoft.com"
    "v10.events.data.microsoft.com"
    "v10.vortex-win.data.microsoft.com"
    "aka.ms"
    "graph.windows.net"
    "umwatsonc.events.data.microsoft.com"
    "kmwatsonc.events.data.microsoft.com"
    "v20.events.data.microsoft.com"
    "footprintdns.com"
    "fp.msedge.net"
    "a-0001.a-msedge.net"
    "a-0002.a-msedge.net"
    "a-0003.a-msedge.net"
    "a-0004.a-msedge.net"
    "a-0005.a-msedge.net"
    "a-0006.a-msedge.net"
    "a-0007.a-msedge.net"
    "a-0008.a-msedge.net"
    "a-0009.a-msedge.net"
    "a1621.g.akamai.net"
    "a1856.g2.akamai.net"
    "a1961.g.akamai.net"
    #"a248.e.akamai.net"            # makes iTunes download button disappear (#43)
    "a978.i6g1.akamai.net"
    "a.ads1.msn.com"
    "a.ads2.msads.net"
    "a.ads2.msn.com"
    "ac3.msn.com"
    "ad.doubleclick.net"
    "adnexus.net"
    "adnxs.com"
    "ads1.msads.net"
    "ads1.msn.com"
    "ads.msn.com"
    "aidps.atdmt.com"
    "aka-cdn-ns.adtech.de"
    "a-msedge.net"
    "any.edge.bing.com"
    "a.rad.msn.com"
    "az361816.vo.msecnd.net"
    "az512334.vo.msecnd.net"
    "b.ads1.msn.com"
    "b.ads2.msads.net"
    "bingads.microsoft.com"
    "b.rad.msn.com"
    "bs.serving-sys.com"
    "c.atdmt.com"
    "cdn.atdmt.com"
    "cds26.ams9.msecn.net"
    "choice.microsoft.com"
    "choice.microsoft.com.nsatc.net"
    "compatexchange.cloudapp.net"
    "corpext.msitadfs.glbdns2.microsoft.com"
    "corp.sts.microsoft.com"
    "cs1.wpc.v0cdn.net"
    "db3aqu.atdmt.com"
    "df.telemetry.microsoft.com"
    "diagnostics.support.microsoft.com"
    "e2835.dspb.akamaiedge.net"
    "e7341.g.akamaiedge.net"
    "e7502.ce.akamaiedge.net"
    "e8218.ce.akamaiedge.net"
    "ec.atdmt.com"
    "fe2.update.microsoft.com.akadns.net"
    "feedback.microsoft-hohm.com"
    "feedback.search.microsoft.com"
    "feedback.windows.com"
    "flex.msn.com"
    "g.msn.com"
    "h1.msn.com"
    "h2.msn.com"
    "hostedocsp.globalsign.com"
    "i1.services.social.microsoft.com"
    "i1.services.social.microsoft.com.nsatc.net"
    "ipv6.msftncsi.com"
    "ipv6.msftncsi.com.edgesuite.net"
    "lb1.www.ms.akadns.net"
    "live.rads.msn.com"
    "m.adnxs.com"
    "msedge.net"
    "msftncsi.com"
    "msnbot-65-55-108-23.search.msn.com"
    "msntest.serving-sys.com"
    "oca.telemetry.microsoft.com"
    "oca.telemetry.microsoft.com.nsatc.net"
    "onesettings-db5.metron.live.nsatc.net"
    "pre.footprintpredict.com"
    "preview.msn.com"
    "rad.live.com"
    "rad.msn.com"
    "redir.metaservices.microsoft.com"
    "reports.wes.df.telemetry.microsoft.com"
    "schemas.microsoft.akadns.net"
    "secure.adnxs.com"
    "secure.flashtalking.com"
    "services.wes.df.telemetry.microsoft.com"
    "settings-sandbox.data.microsoft.com"
    #"settings-win.data.microsoft.com"       # may cause issues with Windows Updates
    "sls.update.microsoft.com.akadns.net"
    #"sls.update.microsoft.com.nsatc.net"    # may cause issues with Windows Updates
    "sqm.df.telemetry.microsoft.com"
    "sqm.telemetry.microsoft.com"
    "sqm.telemetry.microsoft.com.nsatc.net"
    "ssw.live.com"
    "static.2mdn.net"
    "statsfe1.ws.microsoft.com"
    "statsfe2.update.microsoft.com.akadns.net"
    "statsfe2.ws.microsoft.com"
    "survey.watson.microsoft.com"
    "telecommand.telemetry.microsoft.com"
    "telecommand.telemetry.microsoft.com.nsatc.net"
    "telemetry.appex.bing.net"
    "telemetry.microsoft.com"
    "telemetry.urs.microsoft.com"
    "vortex-bn2.metron.live.com.nsatc.net"
    "vortex-cy2.metron.live.com.nsatc.net"
    "vortex.data.microsoft.com"
    "vortex-sandbox.data.microsoft.com"
    "vortex-win.data.microsoft.com"
    "cy2.vortex.data.microsoft.com.akadns.net"
    "watson.live.com"
    "watson.microsoft.com"
    "watson.ppe.telemetry.microsoft.com"
    "watson.telemetry.microsoft.com"
    "watson.telemetry.microsoft.com.nsatc.net"
    "wes.df.telemetry.microsoft.com"
    "win10.ipv6.microsoft.com"
    "www.bingads.microsoft.com"
    "www.go.microsoft.akadns.net"
    "www.msftncsi.com"
    "client.wns.windows.com"
    "wdcp.microsoft.com"                       # may cause issues with Windows Defender Cloud-based protection
    #"dns.msftncsi.com"                         # This causes Windows to think it doesn't have internet
    #"storeedgefd.dsx.mp.microsoft.com"         # breaks Windows Store
    "wdcpalt.microsoft.com"
    "settings-ssl.xboxlive.com"
    "settings-ssl.xboxlive.com-c.edgekey.net"
    "settings-ssl.xboxlive.com-c.edgekey.net.globalredir.akadns.net"
    "e87.dspb.akamaidege.net"
    "insiderservice.microsoft.com"
    "insiderservice.trafficmanager.net"
    "e3843.g.akamaiedge.net"
    "flightingserviceweurope.cloudapp.net"
    #"sls.update.microsoft.com"                 # may cause issues with Windows Updates
    "static.ads-twitter.com"                    # may cause issues with Twitter login
    "www-google-analytics.l.google.com"
    "p.static.ads-twitter.com"                  # may cause issues with Twitter login
    "hubspot.net.edge.net"
    "e9483.a.akamaiedge.net"

    #"www.google-analytics.com"
    #"padgead2.googlesyndication.com"
    "mirror1.malwaredomains.com"
    "mirror.cedia.org.ec"
    "stats.g.doubleclick.net"
    "stats.l.doubleclick.net"
    "adservice.google.de"
    "adservice.google.com"
    "googleads.g.doubleclick.net"
    "pagead46.l.doubleclick.net"
    "hubspot.net.edgekey.net"
    "insiderppe.cloudapp.net"                   # Feedback-Hub
    "livetileedge.dsx.mp.microsoft.com"

    # extra
    "fe2.update.microsoft.com.akadns.net"
    "s0.2mdn.net"
    "statsfe2.update.microsoft.com.akadns.net"
    "survey.watson.microsoft.com"
    "view.atdmt.com"
    "watson.microsoft.com"
    "watson.ppe.telemetry.microsoft.com"
    "watson.telemetry.microsoft.com"
    "watson.telemetry.microsoft.com.nsatc.net"
    "wes.df.telemetry.microsoft.com"
    "m.hotmail.com"

    # can cause issues with Skype (#79) or other services (#171)
    "apps.skype.com"
    "c.msn.com"
    # "login.live.com"                  # prevents login to outlook and other live apps
    "pricelist.skype.com"
    "s.gateway.messenger.live.com"
    "ui.skype.com"
)
Write-Output "" | Out-File -Encoding ASCII -Append $hosts_file
foreach ($domain in $domains) {
    if (-Not (Select-String -Path $hosts_file -Pattern $domain)) {
        Write-Output "0.0.0.0 $domain" | Out-File -Encoding ASCII -Append $hosts_file
    }
}

Write-Output "Adding telemetry ips to firewall"
$ips = @(
    "134.170.30.202"
    "137.116.81.24"
    "157.56.106.189"
    "184.86.53.99"
    "2.22.61.43"
    "2.22.61.66"
    "204.79.197.200"
    "23.218.212.69"
    "65.39.117.230"
    "65.52.108.33"
    "65.55.108.23"
    "64.4.54.254"
    "40.114.241.141"
    "104.45.136.42"
    "40.84.189.107"
    "40.90.137.125"
    "168.63.242.221"
    "52.167.221.184"
    "52.169.64.244"
    "40.85.218.175"
    "104.211.92.54"
    "52.175.198.74"
    "51.140.6.23"
    "40.71.12.231"
    "13.69.65.22"
    "13.78.108.165"
    "13.70.72.233"
    "20.44.8.7"
    "13.86.218.248"
    "40.79.138.41"
    "52.231.18.241"
    "13.75.38.7"
    "102.133.155.50"
    "52.162.110.67"
    "191.233.204.248"
    "13.69.66.140"
    "13.77.52.29"
    "51.107.59.180"
    "40.71.12.235"
    "20.44.8.10"
    "40.71.13.169"
    "13.66.141.156"
    "40.71.13.170"
    "23.96.28.38"
    "13.92.40.198"
    "40.112.49.101"
    "40.117.80.207"
    "157.55.177.6"
    "104.44.140.84"
    "104.215.81.124"
    "23.100.122.113"
    "40.115.103.168"
    "40.115.104.31"
    "40.87.140.215"
    "40.87.138.220"
    "13.80.134.255"
    "40.68.61.229"
    "23.101.69.223"
    "52.232.106.242"
    "23.100.90.7"
    "23.101.13.65"
    "23.101.0.142"
    "23.101.9.4"
    "207.46.224.101"
    "207.46.236.191"
    "137.116.151.139"
    "13.76.87.86"
    "23.96.58.253"
    "13.78.151.158"
    "40.74.59.40"
    "40.70.42.246"
    "40.117.198.0"
    "137.116.226.91"
    "52.163.88.44"
    "52.189.210.240"
    "13.77.201.34"
    "13.78.149.206"
    "52.232.28.146"
    "52.175.241.170"
    "20.36.36.66"
    "52.147.29.101"
    "40.115.155.252"
    "20.188.34.152"
    "52.141.32.103"
    "23.96.58.253"
    "13.78.151.158"
    "40.74.59.40"
    "40.70.42.246"
    "40.117.198.0"
    "137.116.226.91"
    "52.163.88.44"
    "52.189.210.240"
    "13.77.201.34"
    "13.78.149.206"
    "52.232.28.146"
    "52.175.241.170"
    "20.36.36.66"
    "52.147.29.101"
    "40.115.155.252"
    "20.188.34.152"
    "52.141.32.103"
    "23.96.58.253"
    "13.78.151.158"
    "40.74.59.40"
    "40.70.42.246"
    "40.117.198.0"
    "137.116.226.91"
    "52.163.88.44"
    "52.189.210.240"
    "13.77.201.34"
    "13.78.149.206"
    "52.232.28.146"
    "52.175.241.170"
    "20.36.36.66"
    "52.147.29.101"
    "40.115.155.252"
    "20.188.34.152"
    "52.141.32.103"
    "23.96.58.253"
    "13.78.151.158"
    "40.74.59.40"
    "40.70.42.246"
    "40.117.198.0"
    "137.116.226.91"
    "52.163.88.44"
    "52.189.210.240"
    "13.77.201.34"
    "13.78.149.206"
    "52.232.28.146"
    "52.175.241.170"
    "20.36.36.66"
    "52.147.29.101"
    "40.115.155.252"
    "20.188.34.152"
    "52.141.32.103"
    "20.190.60.38"
    "20.190.60.32"
    "52.173.196.230"
    "52.173.196.209"
    "23.102.44.211"
    "23.102.45.216"
    "13.69.51.218"
    "13.69.51.175"
    "138.91.32.98"
    "138.91.37.93"
    "40.121.61.208"
    "40.121.57.2"
    "51.140.60.235"
    "51.140.180.52"
    "52.138.31.112"
    "52.138.31.127"
    "104.211.90.234"
    "104.211.91.254"
    "13.70.124.27"
    "13.75.195.15"
    "52.185.132.101"
    "52.185.132.170"
    "20.188.36.28"
    "40.89.153.171"
    "52.141.22.239"
    "52.141.22.149"
    "102.133.162.233"
    "102.133.161.73"
    "191.232.214.6"
    "191.232.213.239"
    "20.190.60.38"
    "20.190.60.32"
    "52.173.196.230"
    "52.173.196.209"
    "23.102.44.211"
    "23.102.45.216"
    "13.69.51.218"
    "13.69.51.175"
    "138.91.32.98"
    "138.91.37.93"
    "40.121.61.208"
    "40.121.57.2"
    "51.140.60.235"
    "51.140.180.52"
    "52.138.31.112"
    "52.138.31.127"
    "104.211.90.234"
    "104.211.91.254"
    "13.70.124.27"
    "13.75.195.15"
    "52.185.132.101"
    "52.185.132.170"
    "20.188.36.28"
    "40.89.153.171"
    "52.141.22.239"
    "52.141.22.149"
    "102.133.162.233"
    "102.133.161.73"
    "191.232.214.6"
    "191.232.213.239"
    "13.68.31.193"
    "13.66.56.243"
    "13.68.82.8"
    "13.76.218.117"
    "13.76.219.191"
    "13.76.219.210"
    "13.78.130.220"
    "13.78.232.226"
    "13.78.233.133"
    "13.92.194.212"
    "23.97.61.137"
    "23.97.209.97"
    "23.99.49.121"
    "23.99.10.11"
    "23.99.109.44"
    "23.99.109.64"
    "23.99.116.116"
    "23.99.121.207"
    "23.102.4.253"
    "23.102.21.4"
    "23.102.155.140"
    "23.103.182.126"
    "40.68.222.212"
    "40.69.153.67"
    "40.70.220.248"
    "40.70.221.249"
    "40.76.1.176"
    "40.76.12.4"
    "40.76.12.162"
    "40.77.228.47"
    "40.77.228.87"
    "40.77.228.92"
    "40.77.232.101"
    "40.79.85.125"
    "40.83.189.49"
    "40.113.8.255"
    "40.113.10.78"
    "40.113.11.93"
    "40.113.14.159"
    "40.113.22.47"
    "40.113.84.53"
    "40.114.149.220"
    "40.115.1.44"
    "40.117.144.240"
    "40.117.151.29"
    "40.121.144.182"
    "51.140.40.236"
    "51.141.13.164"
    "52.109.8.19"
    "52.109.8.20"
    "52.109.8.21"
    "52.109.12.18"
    "52.109.12.19"
    "52.109.12.20"
    "52.109.12.21"
    "52.109.12.22"
    "52.109.12.23"
    "52.109.12.24"
    "52.109.76.30"
    "52.109.76.31"
    "52.109.76.32"
    "52.109.76.33"
    "52.109.76.34"
    "52.109.76.35"
    "52.109.76.36"
    "52.109.76.40"
    "52.109.88.6"
    "52.109.88.34"
    "52.109.88.35"
    "52.109.88.36"
    "52.109.88.37"
    "52.109.88.38"
    "52.109.88.39"
    "52.109.88.40"
    "52.109.88.44"
    "52.109.120.17"
    "52.109.120.18"
    "52.109.120.19"
    "52.109.120.20"
    "52.109.120.21"
    "52.109.120.22"
    "52.109.120.23"
    "52.109.124.18"
    "52.109.124.19"
    "52.109.124.20"
    "52.109.124.21"
    "52.109.124.22"
    "52.109.124.23"
    "52.109.124.24"
    "52.114.6.46"
    "52.114.6.47"
    "52.114.7.37"
    "52.114.74.43"
    "52.114.74.45"
    "52.114.75.78"
    "52.114.75.79"
    "52.114.76.34"
    "52.114.76.37"
    "52.114.77.33"
    "52.114.77.34"
    "52.114.88.20"
    "52.114.88.28"
    "52.114.88.29"
    "52.114.128.8"
    "52.114.128.43"
    "52.114.128.44"
    "52.114.132.21"
    "52.114.132.73"
    "52.114.132.74"
    "52.114.158.52"
    "52.114.158.91"
    "52.114.158.92"
    "52.138.204.217"
    "52.138.216.83"
    "52.158.238.42"
    "52.164.240.33"
    "52.164.240.59"
    "52.164.241.205"
    "52.169.189.83"
    "52.170.83.19"
    "52.174.22.246"
    "52.178.38.151"
    "52.178.147.240"
    "52.178.151.212"
    "52.178.178.16"
    "52.178.223.23"
    "52.183.114.173"
    "52.229.39.152"
    "52.230.85.180"
    "52.236.42.239"
    "52.236.43.202"
    "65.52.26.28"
    "65.52.100.7"
    "65.52.100.9"
    "65.52.100.11"
    "65.52.100.91"
    "65.52.100.92"
    "65.52.100.93"
    "65.52.100.94"
    "65.52.161.64"
    "65.52.219.207"
    "65.55.29.238"
    "65.55.44.51"
    "65.55.44.54"
    "65.55.44.108"
    "65.55.44.109"
    "65.55.83.120"
    "65.55.113.11"
    "65.55.113.12"
    "65.55.113.13"
    "65.55.176.90"
    "65.55.252.43"
    "65.55.252.63"
    "65.55.252.70"
    "65.55.252.71"
    "65.55.252.72"
    "65.55.252.93"
    "65.55.252.190"
    "65.55.252.202"
    "66.119.147.131"
    "104.41.207.73"
    "104.43.137.66"
    "104.43.139.21"
    "104.43.140.223"
    "104.43.228.53"
    "104.43.228.202"
    "104.43.237.169"
    "104.45.11.195"
    "104.45.214.112"
    "104.46.1.211"
    "104.46.38.64"
    "104.210.4.77"
    "104.210.40.87"
    "104.210.212.243"
    "104.214.35.244"
    "131.253.6.87"
    "131.253.6.103"
    "131.253.40.37"
    "134.170.30.202"
    "134.170.30.203"
    "134.170.30.204"
    "134.170.30.221"
    "134.170.52.151"
    "134.170.235.16"
    "157.56.74.250"
    "157.56.91.77"
    "157.56.106.184"
    "157.56.106.185"
    "157.56.106.189"
    "157.56.113.217"
    "157.56.121.89"
    "157.56.124.87"
    "157.56.149.250"
    "157.56.194.72"
    "157.56.194.73"
    "157.56.194.74"
    "168.61.24.141"
    "168.61.146.25"
    "168.61.149.17"
    "168.61.172.71"
    "168.62.187.13"
    "168.63.100.61"
    "168.63.108.233"
    "191.236.155.80"
    "191.237.218.239"
    "191.239.50.18"
    "191.239.50.77"
    "191.239.52.100"
    "191.239.54.52"
    "207.46.41.202"
    "207.46.134.255"
    "207.68.166.254"
    "13.78.235.126"
    "13.78.235.247"
    "13.79.239.69"
    "13.79.239.82"
    "13.80.12.54"
    "13.81.5.53"
    "13.107.3.128"
    "13.107.3.254"
    "13.107.5.80"
    "13.107.5.88"
    "13.107.6.158"
    "13.107.6.254"
    "13.107.13.88"
    "13.107.18.254"
    "13.107.21.200"
    "13.107.21.229"
    "13.107.42.11"
    "13.107.42.254"
    "13.107.46.88"
    "13.107.47.88"
    "23.96.52.53"
    "23.96.208.208"
    "23.97.178.173"
    "23.100.122.175"
    "23.101.156.198"
    "23.101.158.111"
    "40.70.0.108"
    "40.77.225.248"
    "40.77.230.45"
    "40.83.74.46"
    "40.83.127.51"
    "40.90.136.1"
    "40.90.136.19"
    "40.90.136.20"
    "40.90.136.163"
    "40.90.136.166"
    "40.91.76.238"
    "40.101.46.178"
    "40.112.72.44"
    "40.112.90.122"
    "40.112.91.29"
    "40.113.97.222"
    "40.114.241.141"
    "40.117.190.72"
    "40.118.103.7"
    "40.118.106.130"
    "40.121.213.159"
    "40.126.9.5"
    "40.127.142.76"
    "40.127.195.156"
    "51.136.15.177"
    "51.136.37.147"
    "51.140.65.84"
    "51.140.98.69"
    "51.140.127.197"
    "51.141.26.229"
    "51.141.32.51"
    "51.141.166.104"
    "51.144.108.120"
    "52.97.146.34"
    "52.98.66.98"
    "52.138.148.87"
    "52.138.148.89"
    "52.138.148.159"
    "52.142.114.2"
    "52.142.114.176"
    "52.164.191.55"
    "52.164.227.208"
    "52.164.251.44"
    "52.166.110.64"
    "52.166.110.215"
    "52.166.120.77"
    "52.168.24.174"
    "52.169.71.150"
    "52.170.194.77"
    "52.171.136.200"
    "52.178.161.41"
    "52.178.163.85"
    "52.178.193.116"
    "52.179.13.204"
    "52.183.104.36"
    "52.230.10.183"
    "52.232.16.77"
    "52.232.19.76"
    "52.232.69.150"
    "52.233.199.249"
    "64.4.54.18"
    "64.4.54.22"
    "64.4.54.253"
    "64.4.54.254"
    "65.52.98.231"
    "65.54.187.131"
    "65.55.108.23"
    "65.55.130.50"
    "104.40.210.32"
    "104.40.211.35"
    "104.41.219.140"
    "104.42.41.237"
    "104.44.80.172"
    "104.44.88.24"
    "104.44.88.28"
    "104.44.88.103"
    "104.45.18.177"
    "104.214.77.221"
    "104.214.220.181"
    "104.215.146.200"
    "131.253.14.227"
    "131.253.14.229"
    "131.253.14.230"
    "131.253.14.231"
    "134.170.178.97"
    "134.170.185.70"
    "134.170.188.248"
    "137.117.235.16"
    "138.91.122.49"
    "157.55.109.7"
    "157.55.109.224"
    "157.55.109.226"
    "157.55.109.228"
    "157.55.109.230"
    "157.55.109.232"
    "157.55.129.21"
    "157.55.134.136"
    "157.55.134.138"
    "157.55.134.140"
    "157.55.134.142"
    "157.55.135.128"
    "157.55.135.130"
    "157.55.135.132"
    "157.55.135.134"
    "157.56.57.5"
    "168.63.18.79"
    "168.63.102.42"
    "191.237.208.126"
    "191.239.213.197"
    "204.152.141.244"
    "207.46.7.252"
    "207.46.101.29"
    "207.46.153.155"
    "207.46.194.14"
    "207.46.194.25"
    "207.46.194.33"
    "207.46.194.40"
    "207.46.223.94"
    "13.68.87.47"
    "13.68.87.175"
    "13.68.88.129"
    "13.68.93.109"
    "13.74.179.117"
    "13.78.168.230"
    "13.78.177.144"
    "13.78.179.199"
    "13.78.180.50"
    "13.78.180.90"
    "13.78.184.44"
    "13.78.184.186"
    "13.78.186.254"
    "13.78.187.58"
    "13.78.230.134"
    "13.83.148.235"
    "13.85.88.16"
    "13.86.124.174"
    "13.86.124.184"
    "13.86.124.191"
    "13.92.211.120"
    "13.107.4.50"
    "13.107.4.52"
    "13.107.246.10"
    "13.107.246.254"
    "20.36.218.70"
    "20.36.222.39"
    "20.42.24.29"
    "23.103.189.125"
    "23.103.189.126"
    "23.103.189.157"
    "23.103.189.158"
    "40.67.248.104"
    "40.67.251.132"
    "40.67.251.134"
    "40.67.252.206"
    "40.67.253.249"
    "40.67.254.36"
    "40.67.254.97"
    "40.67.255.199"
    "40.69.216.73"
    "40.69.216.129"
    "40.69.216.251"
    "40.69.218.62"
    "40.69.219.197"
    "40.69.220.46"
    "40.69.221.239"
    "40.69.222.109"
    "40.69.223.39"
    "40.69.223.198"
    "40.77.224.8"
    "40.77.224.11"
    "40.77.224.145"
    "40.77.224.254"
    "40.77.226.13"
    "40.77.226.181"
    "40.77.226.246"
    "40.77.226.247"
    "40.77.226.248"
    "40.77.226.249"
    "40.77.226.250"
    "40.77.229.8"
    "40.77.229.9"
    "40.77.229.12"
    "40.77.229.13"
    "40.77.229.16"
    "40.77.229.21"
    "40.77.229.22"
    "40.77.229.24"
    "40.77.229.26"
    "40.77.229.27"
    "40.77.229.29"
    "40.77.229.30"
    "40.77.229.32"
    "40.77.229.35"
    "40.77.229.38"
    "40.77.229.44"
    "40.77.229.45"
    "40.77.229.50"
    "40.77.229.53"
    "40.77.229.62"
    "40.77.229.65"
    "40.77.229.67"
    "40.77.229.69"
    "40.77.229.70"
    "40.77.229.71"
    "40.77.229.74"
    "40.77.229.76"
    "40.77.229.80"
    "40.77.229.81"
    "40.77.229.82"
    "40.77.229.88"
    "40.77.229.133"
    "40.77.229.141"
    "40.77.229.199"
    "40.79.65.78"
    "40.79.65.123"
    "40.79.65.235"
    "40.79.65.237"
    "40.79.66.194"
    "40.79.66.209"
    "40.79.67.176"
    "40.79.70.158"
    "40.91.73.219"
    "40.91.75.5"
    "52.161.15.246"
    "52.167.222.82"
    "52.167.222.147"
    "52.167.223.135"
    "52.169.82.131"
    "52.169.83.3"
    "52.169.87.42"
    "52.169.123.48"
    "52.175.23.79"
    "52.178.192.146"
    "52.183.47.176"
    "52.183.118.171"
    "52.184.152.136"
    "52.184.155.206"
    "52.187.60.107"
    "52.229.170.171"
    "52.229.170.224"
    "52.229.171.86"
    "52.229.171.202"
    "52.229.172.155"
    "52.229.174.29"
    "52.229.174.172"
    "52.229.174.233"
    "52.229.175.79"
    "64.4.27.50"
    "65.52.108.29"
    "65.52.108.33"
    "65.52.108.59"
    "65.52.108.90"
    "65.52.108.153"
    "65.52.108.154"
    "65.52.108.185"
    "65.55.163.76"
    "65.55.163.78"
    "65.55.163.80"
    "65.55.163.82"
    "65.55.163.90"
    "65.55.163.219"
    "65.55.163.220"
    "65.55.163.221"
    "65.55.163.222"
    "65.55.242.254"
    "66.119.144.157"
    "66.119.144.158"
    "66.119.144.189"
    "66.119.144.190"
    "111.221.29.11"
    "111.221.29.40"
    "111.221.29.134"
    "111.221.29.253"
    "111.221.29.254"
    "131.253.33.50"
    "131.253.33.200"
    "131.253.33.203"
    "131.253.33.254"
    "131.253.34.230"
    "131.253.34.234"
    "131.253.34.237"
    "131.253.34.243"
    "131.253.34.246"
    "131.253.34.247"
    "131.253.34.249"
    "131.253.34.252"
    "131.253.34.255"
    "134.170.51.187"
    "134.170.51.188"
    "134.170.51.190"
    "134.170.51.246"
    "134.170.51.247"
    "134.170.51.248"
    "134.170.53.29"
    "134.170.53.30"
    "134.170.115.55"
    "134.170.115.56"
    "134.170.115.60"
    "134.170.115.62"
    "134.170.165.248"
    "134.170.165.249"
    "134.170.165.251"
    "134.170.165.253"
    "157.55.133.204"
    "157.55.240.89"
    "157.55.240.126"
    "157.55.240.220"
    "157.56.77.138"
    "157.56.77.139"
    "157.56.77.140"
    "157.56.77.141"
    "157.56.77.148"
    "157.56.77.149"
    "157.56.96.54"
    "157.56.96.58"
    "157.56.96.123"
    "157.56.96.157"
    "191.232.80.53"
    "191.232.80.58"
    "191.232.80.60"
    "191.232.80.62"
    "191.232.139.2"
    "191.232.139.182"
    "191.232.139.253"
    "191.232.139.254"
    "191.234.72.183"
    "191.234.72.186"
    "191.234.72.188"
    "191.234.72.190"
    "207.46.114.58"
    "207.46.114.61"
)
Remove-NetFirewallRule -DisplayName "Block Telemetry IPs" -ErrorAction SilentlyContinue
New-NetFirewallRule -DisplayName "Block Telemetry IPs" -Direction Outbound `
    -Action Block -RemoteAddress ([string[]]$ips)
